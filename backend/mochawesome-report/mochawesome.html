<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:3,&quot;tests&quot;:29,&quot;passes&quot;:5,&quot;pending&quot;:0,&quot;failures&quot;:24,&quot;start&quot;:&quot;2025-10-02T07:32:47.401Z&quot;,&quot;end&quot;:&quot;2025-10-02T07:32:47.416Z&quot;,&quot;duration&quot;:15,&quot;testsRegistered&quot;:29,&quot;passPercent&quot;:17.24137931034483,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;8e847bd8-4677-4fcf-a884-212c9fd6f317&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;title&quot;:&quot;Appointments API with Strategies&quot;,&quot;fullFile&quot;:&quot;/Users/jasper/IFN636_Assessment/backend/test/appointments.test.js&quot;,&quot;file&quot;:&quot;/test/appointments.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create appointment under strict strategy&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should create appointment under strict strategy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;Alice\&quot;,\n    petName: \&quot;Buddy\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:00:00.000Z\&quot;,\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Checkup\&quot;,\n    strategy: \&quot;strict\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(201);\n    createdId = res.body._id;\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:13:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;cd3437fd-c350-4e01-b2e3-6fe2a890a963&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject overlapping appointment under strict strategy&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should reject overlapping appointment under strict strategy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;Bob\&quot;,\n    petName: \&quot;Charlie\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:00:00.000Z\&quot;, // same time as Alice\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Vaccination\&quot;,\n    strategy: \&quot;strict\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(400);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:33:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;206728ab-b2c4-4eb6-85e9-0b6b405b596e&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject appointments within buffer time&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should reject appointments within buffer time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;Eve\&quot;,\n    petName: \&quot;Milo\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:20:00.000Z\&quot;, // within 15min buffer\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Surgery\&quot;,\n    strategy: \&quot;buffer\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(400);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:53:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;1754020d-8549-4a93-af98-cf30645bf866&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow overlapping appointment under relaxed strategy&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should allow overlapping appointment under relaxed strategy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;Sam\&quot;,\n    petName: \&quot;Luna\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:00:00.000Z\&quot;, // overlaps but relaxed allows\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Follow-up\&quot;,\n    strategy: \&quot;relaxed\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(201);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:73:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;8f29ad2c-5941-4643-b0c7-10c1d7d7f885&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow emergency appointment even if overlapping&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should allow emergency appointment even if overlapping&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;EmergencyUser\&quot;,\n    petName: \&quot;Rocky\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:00:00.000Z\&quot;, // overlaps, but emergency\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Emergency\&quot;,\n    strategy: \&quot;priority\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(201);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:93:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;1911369f-9301-4d07-9ed8-07ec4a083d7c&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow small overlaps under flexible strategy&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should allow small overlaps under flexible strategy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;John\&quot;,\n    petName: \&quot;Max\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:25:00.000Z\&quot;, // 5 min overlap allowed\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Checkup\&quot;,\n    strategy: \&quot;flexible\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(201);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:113:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;d81bb33e-6a60-45b9-94a2-01a4f667efd4&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject large overlaps under flexible strategy&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should reject large overlaps under flexible strategy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .post(\&quot;/api/appointments\&quot;)\n  .send({\n    appointedBy: \&quot;Kate\&quot;,\n    petName: \&quot;Bella\&quot;,\n    vetName: \&quot;Dr. Smith\&quot;,\n    appointDate: \&quot;2025-09-30T10:10:00.000Z\&quot;, // overlaps too much\n    duration: 30,\n    status: \&quot;Scheduled\&quot;,\n    reason: \&quot;Checkup\&quot;,\n    strategy: \&quot;flexible\&quot;\n  })\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(400);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:132:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;5faa4c18-449d-4142-b724-34f1029dceb2&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete appointment&quot;,&quot;fullTitle&quot;:&quot;Appointments API with Strategies should delete appointment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;chai.request(server)\n  .delete(`/api/appointments/${createdId}`)\n  .end((err, res) =&gt; {\n    expect(res).to.have.status(200);\n    expect(res.body.message).to.equal(\&quot;Appointment deleted\&quot;);\n    done();\n  });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: chai.request is not a function&quot;,&quot;estack&quot;:&quot;TypeError: chai.request is not a function\n    at Context.&lt;anonymous&gt; (test/appointments.test.js:152:10)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;2c457ae9-7499-449c-ab8e-0b5018ba3bcd&quot;,&quot;parentUUID&quot;:&quot;5923c505-4a28-433b-a30c-f288a8297f9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;cd3437fd-c350-4e01-b2e3-6fe2a890a963&quot;,&quot;206728ab-b2c4-4eb6-85e9-0b6b405b596e&quot;,&quot;1754020d-8549-4a93-af98-cf30645bf866&quot;,&quot;8f29ad2c-5941-4643-b0c7-10c1d7d7f885&quot;,&quot;1911369f-9301-4d07-9ed8-07ec4a083d7c&quot;,&quot;d81bb33e-6a60-45b9-94a2-01a4f667efd4&quot;,&quot;5faa4c18-449d-4142-b724-34f1029dceb2&quot;,&quot;2c457ae9-7499-449c-ab8e-0b5018ba3bcd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;title&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD)&quot;,&quot;fullFile&quot;:&quot;/Users/jasper/IFN636_Assessment/backend/test/CreateAccount.test.js&quot;,&quot;file&quot;:&quot;/test/CreateAccount.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD)\&quot;&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) \&quot;before each\&quot; hook in \&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Fresh req/res each test\nreq = { body: {}, params: {}, user: {} };\nres = {\n  status: sandbox.stub().returnsThis(),\n  json: sandbox.stub(),\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d3b21221-c660-4f5b-8612-61540cfef630&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD)\&quot;&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) \&quot;after each\&quot; hook in \&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;300933d3-26d2-4cc4-a6cb-6b14deb958ef&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;R1: Register → creates account and returns token &amp; role&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) R1: Register → creates account and returns token &amp; role&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  name: \&quot;Alice Vet\&quot;,\n  email: \&quot;Alice@Example.com\&quot;,    // verify normalization\n  password: \&quot;Passw0rd!\&quot;,\n  role: \&quot;Vet\&quot;,                   // verify normalization\n};\n// Email not in use\nsandbox.stub(User, \&quot;findOne\&quot;).resolves(null);\n// Created user returned by model\nsandbox.stub(User, \&quot;create\&quot;).resolves({\n  _id: \&quot;user_123\&quot;,\n  name: \&quot;Alice Vet\&quot;,\n  email: \&quot;alice@example.com\&quot;,\n  role: \&quot;vet\&quot;,\n});\nsandbox.stub(jwt, \&quot;sign\&quot;).returns(\&quot;fake.jwt.token\&quot;);\nawait registerUser(req, res);\nexpect(User.findOne.calledOnceWith({ email: \&quot;alice@example.com\&quot; })).to.be.true;\nexpect(User.create.calledOnce).to.be.true;\nexpect(res.status.calledWith(201)).to.be.true;\nconst payload = res.json.firstCall.args[0];\nexpect(payload).to.include.keys([\&quot;id\&quot;, \&quot;name\&quot;, \&quot;email\&quot;, \&quot;role\&quot;, \&quot;token\&quot;]);\nexpect(payload.email).to.equal(\&quot;alice@example.com\&quot;);\nexpect(payload.role).to.equal(\&quot;vet\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e96e1d01-17cd-41e0-87d9-b7ef5e65dec2&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Login: accepts valid credentials (encapsulation: checkPassword)&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) Login: accepts valid credentials (encapsulation: checkPassword)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = { email: \&quot;alice@example.com\&quot;, password: \&quot;Passw0rd!\&quot; };\n// When controller does: await User.findOne({email}).select(\&quot;+password\&quot;)\n// we must return an object with .select() -&gt; Promise&lt;user&gt;\nconst fakeUser = {\n  _id: \&quot;user_123\&quot;,\n  name: \&quot;Alice Vet\&quot;,\n  email: \&quot;alice@example.com\&quot;,\n  role: \&quot;vet\&quot;,\n  checkPassword: sandbox.stub().resolves(true), // encapsulated check\n};\nconst selectStub = sandbox.stub().returns(Promise.resolve(fakeUser));\nsandbox.stub(User, \&quot;findOne\&quot;).returns({ select: selectStub });\nsandbox.stub(jwt, \&quot;sign\&quot;).returns(\&quot;fake.jwt.token\&quot;);\nawait loginUser(req, res);\nexpect(User.findOne.calledOnceWith({ email: \&quot;alice@example.com\&quot; })).to.be.true;\nexpect(selectStub.calledOnceWith(\&quot;+password\&quot;)).to.be.true;\nexpect(fakeUser.checkPassword.calledOnceWith(\&quot;Passw0rd!\&quot;)).to.be.true;\nexpect(res.status.called).to.be.false; // should be 200 implicitly\nconst body = res.json.firstCall.args[0];\nexpect(body).to.include.keys([\&quot;id\&quot;, \&quot;name\&quot;, \&quot;email\&quot;, \&quot;role\&quot;, \&quot;token\&quot;]);\nexpect(body.email).to.equal(\&quot;alice@example.com\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0bd126e-5291-4f65-b682-3f133c12712e&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Edit profile: updates basic fields and returns user (no password leak)&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) Edit profile: updates basic fields and returns user (no password leak)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.user = { id: \&quot;user_123\&quot; };\nreq.body = { name: \&quot;Alice Updated\&quot;, phoneNumber: \&quot;0400123456\&quot; };\nconst updated = {\n  _id: \&quot;user_123\&quot;,\n  name: \&quot;Alice Updated\&quot;,\n  email: \&quot;alice@example.com\&quot;,\n  role: \&quot;vet\&quot;,\n  phoneNumber: \&quot;0400123456\&quot;,\n};\nsandbox\n  .stub(User, \&quot;findByIdAndUpdate\&quot;)\n  .resolves(updated); // controller usually does .select(\&quot;-password\&quot;) or similar\nawait updateUserProfile(req, res);\nexpect(User.findByIdAndUpdate.calledOnce).to.be.true;\nexpect(res.status.called).to.be.false; // 200 default\nconst body = res.json.firstCall.args[0];\nexpect(body).to.include({ name: \&quot;Alice Updated\&quot;, email: \&quot;alice@example.com\&quot; });\nexpect(body).to.not.have.property(\&quot;password\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (test/CreateAccount.test.js:131:52)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;8958001e-bef4-4cde-9399-c5aabf8ff14d&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Pet: Create → adds a new pet for the current user&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) Pet: Create → adds a new pet for the current user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.user = { id: \&quot;user_123\&quot;, role: \&quot;staff\&quot; };\nreq.body = {\n  name: \&quot;Buddy\&quot;,\n  species: \&quot;Dog\&quot;,\n  age: 3,\n  allergyMed: \&quot;None\&quot;,\n  ownerName: \&quot;Alice\&quot;,\n  ownerPhone: \&quot;0400123456\&quot;,\n  ownerEmail: \&quot;alice@example.com\&quot;,\n};\nconst created = {\n  _id: \&quot;pet_001\&quot;,\n  ...req.body,\n  ownerId: \&quot;user_123\&quot;,\n};\nsandbox.stub(Pet, \&quot;create\&quot;).resolves(created);\nawait addPet(req, res);\nexpect(Pet.create.calledOnce).to.be.true;\nexpect(res.status.calledWith(201)).to.be.true;\nexpect(res.json.calledWith(created)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99e30aa6-f2c7-43d1-b0c6-b3eb384e2fa4&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Pet: Update → edits a pet by id&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) Pet: Update → edits a pet by id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.user = { id: \&quot;user_123\&quot;, role: \&quot;staff\&quot; };\nreq.params.id = \&quot;pet_001\&quot;;\nreq.body = { age: 4 };\nconst updatedPet = {\n  _id: \&quot;pet_001\&quot;,\n  name: \&quot;Buddy\&quot;,\n  species: \&quot;Dog\&quot;,\n  age: 4,\n  ownerId: \&quot;user_123\&quot;,\n};\nsandbox.stub(Pet, \&quot;findByIdAndUpdate\&quot;).resolves(updatedPet);\nawait updatePet(req, res);\nexpect(Pet.findByIdAndUpdate.calledOnce).to.be.true;\nexpect(res.status.called).to.be.false; // 200 default\nexpect(res.json.calledWith(updatedPet)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94372ca0-72da-4b8c-9d1c-8744dd54515c&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Pet: Remove → deletes a pet by id&quot;,&quot;fullTitle&quot;:&quot;App Flow Unit Tests (Register → Login → Edit Profile → Pet CRUD) Pet: Remove → deletes a pet by id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.user = { id: \&quot;user_123\&quot;, role: \&quot;staff\&quot; };\nreq.params.id = \&quot;pet_001\&quot;;\nsandbox.stub(Pet, \&quot;findByIdAndDelete\&quot;).resolves({ _id: \&quot;pet_001\&quot; });\nawait deletePet(req, res);\nexpect(Pet.findByIdAndDelete.calledOnceWith(\&quot;pet_001\&quot;)).to.be.true;\nexpect(res.status.called).to.be.false; // 200 default\nexpect(res.json.calledWithMatch({ message: \&quot;Pet deleted\&quot; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa45357b-8425-4fb9-9f4d-def1873514c7&quot;,&quot;parentUUID&quot;:&quot;e77485c5-e3cd-45e7-962f-a22aa7c9c5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e96e1d01-17cd-41e0-87d9-b7ef5e65dec2&quot;,&quot;b0bd126e-5291-4f65-b682-3f133c12712e&quot;,&quot;99e30aa6-f2c7-43d1-b0c6-b3eb384e2fa4&quot;,&quot;94372ca0-72da-4b8c-9d1c-8744dd54515c&quot;,&quot;aa45357b-8425-4fb9-9f4d-def1873514c7&quot;],&quot;failures&quot;:[&quot;8958001e-bef4-4cde-9399-c5aabf8ff14d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;title&quot;:&quot;Unit Test of Treatment Records&quot;,&quot;fullFile&quot;:&quot;/Users/jasper/IFN636_Assessment/backend/test/treatment_records.test.js&quot;,&quot;file&quot;:&quot;/test/treatment_records.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Unit Test of Treatment Records\&quot;&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records \&quot;before each\&quot; hook in \&quot;Unit Test of Treatment Records\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\nreq = { body: {}, params: {} };\nres = {\n  status: sandbox.stub().returnsThis(),\n  json: sandbox.stub(),\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;683eda1a-9631-48af-be57-935393161121&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Unit Test of Treatment Records\&quot;&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records \&quot;after each\&quot; hook in \&quot;Unit Test of Treatment Records\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91ba7940-b68c-49f9-b323-8095158bfccb&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;#T1: should fail if Pet Name is empty&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T1: should fail if Pet Name is empty&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = { petName: \&quot;\&quot;, vetName: \&quot;Doctor Dolittle\&quot; };\nconst treatment = new Treatment(req.body);\ntry {\n  await treatment.validate();\n  assert.fail(\&quot;Validation should have failed\&quot;);\n} catch (err) {\n  assert.include(err.message, \&quot;petName\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:32:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;fb0441c4-6f17-4c86-a008-9c13c18e156a&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T2: should fail if Vet Name is empty&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T2: should fail if Vet Name is empty&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = { petName: \&quot;Habaobao\&quot;, vetName: \&quot;\&quot; };\nconst treatment = new Treatment(req.body);\ntry {\n  await treatment.validate();\n  assert.fail(\&quot;Validation should have failed\&quot;);\n} catch (err) {\n  assert.include(err.message, \&quot;vetName\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:42:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;058b69ed-8c1b-42e0-b848-46e467a4b2b7&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T3: should fail if Nurse Name is empty&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T3: should fail if Nurse Name is empty&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;\&quot;,\n};\nconst treatment = new Treatment(req.body);\ntry {\n  await treatment.validate();\n  assert.fail(\&quot;Validation should have failed\&quot;);\n} catch (err) {\n  assert.include(err.message, \&quot;nurseName\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:56:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;61204cc3-e710-4b32-a099-74bde2f1179b&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T4: should have Diagnosis Record&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T4: should have Diagnosis Record&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  diagnosisRecords: [\n    { weight: \&quot;1.9\&quot;, temperature: \&quot;38.5\&quot;, symptoms: \&quot;cough\&quot; },\n  ],\n};\nconst treatment = new Treatment(req.body);\nawait treatment.validate();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:73:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;971f0264-1814-4216-bb7e-83fdb1ad8366&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T5: should have Medication&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T5: should have Medication&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  medication: [\n    {\n      medicationName: \&quot;Antibiotic\&quot;,\n      dose: \&quot;5mg\&quot;,\n      frequency: \&quot;2 pills per day\&quot;,\n    },\n  ],\n};\nconst treatment = new Treatment(req.body);\nawait treatment.validate();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:90:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;16c1d264-e2bd-4bbc-82e8-d96232cc87e2&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T6: should have Vaccination&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T6: should have Vaccination&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  vaccination: [\n    { vaccineName: \&quot;Triple Vaccine\&quot;, vaccinationDate: \&quot;2025-09-27\&quot; },\n  ],\n};\nconst treatment = new Treatment(req.body);\nawait treatment.validate();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:103:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;77d3d5c0-bf2d-44fa-954f-4e41601af018&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T7: if have followUp and followUpDate&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T7: if have followUp and followUpDate&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  followUp: true,\n  followUpDate: \&quot;2025-10-20\&quot;,\n};\nconst treatment = new Treatment(req.body);\nawait treatment.validate();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:114:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;0b174b43-bbe2-46f5-85ae-bd2fc874c525&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T8: should include Payment and check isPaid&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T8: should include Payment and check isPaid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = {\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  payment: \&quot;111\&quot;,\n  isPaid: true,\n};\nconst treatment = new Treatment(req.body);\nawait treatment.validate();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:125:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;47a3a458-a62e-43ea-990a-0cecb77afc82&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T9: should add a new treatment&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T9: should add a new treatment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body = { petName: \&quot;Habaobao\&quot;, vetName: \&quot;Doctor Dolittle\&quot; };\nconst fakeTreatment = { ...req.body, _id: \&quot;001\&quot; };\nsandbox.stub(Treatment.prototype, \&quot;save\&quot;).resolves(fakeTreatment);\nawait addTreatment(req, res);\nexpect(res.status.calledWith(201)).to.be.true;\nexpect(res.json.calledWith(fakeTreatment)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Trying to stub property &#x27;save&#x27; of undefined&quot;,&quot;estack&quot;:&quot;Error: Trying to stub property &#x27;save&#x27; of undefined\n    at throwOnFalsyObject (node_modules/sinon/lib/sinon/throw-on-falsy-object.js:7:15)\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:79:24)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:455:39)\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:134:13)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;c2d0c55d-00b6-4ef6-b3fd-e62e35e499a8&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T10: should return all treatments&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T10: should return all treatments&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fakeList = [{ _id: \&quot;001\&quot;, petName: \&quot;Habaobao\&quot; }];\nsandbox.stub(Treatment, \&quot;find\&quot;).resolves(fakeList);\nawait getTreatments(req, res);\nexpect(res.status.calledWith(200)).to.be.true;\nexpect(res.json.calledWith(fakeList)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property find&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property find\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:455:39)\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:145:13)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;6047fb95-addc-46c4-bea1-46763f808ef4&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T11: should update a treatment&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T11: should update a treatment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.params.id = \&quot;001\&quot;;\nreq.body = { vetName: \&quot;Doctor Dolittle\&quot; };\nconst fakeUpdated = {\n  _id: \&quot;001\&quot;,\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n};\nsandbox.stub(Treatment, \&quot;findByIdAndUpdate\&quot;).resolves(fakeUpdated);\nawait updateTreatment(req, res);\nexpect(res.status.calledWith(200)).to.be.true;\nexpect(res.json.calledWith(fakeUpdated)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property findByIdAndUpdate&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property findByIdAndUpdate\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:455:39)\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:163:13)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;a1355e72-80a3-4023-ad4f-fc6b7212bb33&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T12: should delete a treatment&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T12: should delete a treatment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.params.id = \&quot;001\&quot;;\nsandbox.stub(Treatment, \&quot;findByIdAndDelete\&quot;).resolves({ _id: \&quot;001\&quot; });\nawait deleteTreatment(req, res);\nexpect(res.status.calledWith(200)).to.be.true;\nexpect(res.json.calledWithMatch({ message: \&quot;Treatment deleted\&quot; })).to.be\n  .true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property findByIdAndDelete&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property findByIdAndDelete\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:455:39)\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:175:13)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;ad396434-3b03-42ab-89d5-8f0ea2fb5c86&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T13: should remove a Diagnosis Record&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T13: should remove a Diagnosis Record&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const treatment = new Treatment({\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  diagnosisRecords: [\n    { weight: \&quot;1.9\&quot;, temperature: \&quot;38.5\&quot;, symptoms: \&quot;cough\&quot; },\n  ],\n});\nsandbox.stub(Treatment.prototype, \&quot;save\&quot;).resolves(treatment);\nawait treatment.save();\ntreatment.diagnosisRecords.id(treatment.diagnosisRecords[0]._id).remove();\nawait treatment.save();\nexpect(treatment.diagnosisRecords).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:184:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;fdd6ff2a-0f12-4afe-836e-d8df7aa3cbcd&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T14: should remove a Medication&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T14: should remove a Medication&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const treatment = new Treatment({\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  medication: [\n    {\n      medicationName: \&quot;Antibiotic\&quot;,\n      dose: \&quot;5mg\&quot;,\n      frequency: \&quot;2 pills per day\&quot;,\n    },\n  ],\n});\nsandbox.stub(Treatment.prototype, \&quot;save\&quot;).resolves(treatment);\nawait treatment.save();\ntreatment.medication.id(treatment.medication[0]._id).remove();\nawait treatment.save();\nexpect(treatment.medication).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:203:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;72456758-3bbe-4f68-84cf-8ef52898090b&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#T15: should remove a Vaccination&quot;,&quot;fullTitle&quot;:&quot;Unit Test of Treatment Records #T15: should remove a Vaccination&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const treatment = new Treatment({\n  petName: \&quot;Habaobao\&quot;,\n  vetName: \&quot;Doctor Dolittle\&quot;,\n  nurseName: \&quot;Nancy\&quot;,\n  vaccination: [\n    { vaccineName: \&quot;Triple Vaccine\&quot;, vaccinationDate: \&quot;2025-09-27\&quot; },\n  ],\n});\nsandbox.stub(Treatment.prototype, \&quot;save\&quot;).resolves(treatment);\nawait treatment.save();\ntreatment.vaccination.id(treatment.vaccination[0]._id).remove();\nawait treatment.save();\nexpect(treatment.vaccination).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Treatment is not a constructor&quot;,&quot;estack&quot;:&quot;TypeError: Treatment is not a constructor\n    at Context.&lt;anonymous&gt; (test/treatment_records.test.js:227:23)\n    at process.processImmediate (node:internal/timers:485:21)&quot;},&quot;uuid&quot;:&quot;df249dfc-906e-43bd-85bf-9c3b0ffbc24f&quot;,&quot;parentUUID&quot;:&quot;9467a2b0-533e-4f55-a9e5-1a01ff8fef1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;fb0441c4-6f17-4c86-a008-9c13c18e156a&quot;,&quot;058b69ed-8c1b-42e0-b848-46e467a4b2b7&quot;,&quot;61204cc3-e710-4b32-a099-74bde2f1179b&quot;,&quot;971f0264-1814-4216-bb7e-83fdb1ad8366&quot;,&quot;16c1d264-e2bd-4bbc-82e8-d96232cc87e2&quot;,&quot;77d3d5c0-bf2d-44fa-954f-4e41601af018&quot;,&quot;0b174b43-bbe2-46f5-85ae-bd2fc874c525&quot;,&quot;47a3a458-a62e-43ea-990a-0cecb77afc82&quot;,&quot;c2d0c55d-00b6-4ef6-b3fd-e62e35e499a8&quot;,&quot;6047fb95-addc-46c4-bea1-46763f808ef4&quot;,&quot;a1355e72-80a3-4023-ad4f-fc6b7212bb33&quot;,&quot;ad396434-3b03-42ab-89d5-8f0ea2fb5c86&quot;,&quot;fdd6ff2a-0f12-4afe-836e-d8df7aa3cbcd&quot;,&quot;72456758-3bbe-4f68-84cf-8ef52898090b&quot;,&quot;df249dfc-906e-43bd-85bf-9c3b0ffbc24f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.4&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;6.3.1&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportFilename&quot;:&quot;mochawesome&quot;},&quot;version&quot;:&quot;5.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;backend&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/Users/jasper/IFN636_Assessment/backend/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/Users/jasper/IFN636_Assessment/backend/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>